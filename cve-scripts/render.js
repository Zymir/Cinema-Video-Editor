var duracionTiempo=0;
var isStoped = false;
var apuntador=0;
var tiempoForPause=0;
var worker;

function render(index){
	if(index < lineaVideo.getIndex()){
		updateTime();
		var obj = lineaVideo.get(index);//Objeto compuesto
		var html = obj.obj.print();
		$('#player').html(html);
		if(obj.type==3){
			document.getElementById('theVideo').play();
			document.getElementById('theVideo').volume=0;

		}
	}else{
		//Ha acabado
		renderStop();
	}
	
}
function updateTime(){
	tiempoForPause++;
	var totalSegundos = lineaVideo.getTotalSegundos();
	var acumulSegundos = parseInt(lineaVideo.getAcumulada(apuntador))+parseInt(tiempoForPause);
	$('#textItBaby').html(secondsToMinutes(acumulSegundos)+"/"+secondsToMinutes(totalSegundos));
}

function renderPlay(){
	isStoped = false;
	render(apuntador);
	var obj = lineaVideo.get(apuntador);
	worker = new Worker('cve-scripts/cveClock.js');
    worker.postMessage(obj.duracion);
	
	worker.onmessage = function (event) {  
		var result =  (event.data);
		switch (event.data){
			case "END":
				tiempoForPause=0;
				apuntador++;
				if(apuntador < lineaVideo.getIndex()){
					var obj = lineaVideo.get(apuntador);
    				worker.postMessage(obj.duracion);
				}
				render(apuntador);		
				break;
			case "SEC":
				updateTime();
				break;
			default:
				alert("different");
				break;
		}
	}
	
	//if Audio, let's play it
	
	if(lineaAudio.getIndex() > 0){
		var obj = lineaAudio.get(0);
		var src= obj.obj.src;
		$('#media').attr('src',src);
		$('#media').attr('src',src);
		document.getElementById('media').play();
		document.getElementById('media').currentTime=0;
	}	
}

function renderStop(){
	if(worker != null){
		worker.terminate();
	}
	duracionTiempo=0;
	isStoped = false;
	apuntador=0;
	tiempoForPause=0;
	var totalSegundos = lineaVideo.getTotalSegundos();
	$('#textItBaby').html("0:0/"+secondsToMinutes(totalSegundos));
	$('#player').html('');
	isStoped=true;
	
	if(lineaAudio.getIndex() > 0){
		document.getElementById('media').pause();
	}	
	
}
function renderMute(){
	if(document.getElementById('media').volume==0){
		document.getElementById('media').volume=1;
	}else{
		document.getElementById('media').volume=0;
	}
}

function loockForPushed(){
	if ($(".STOPpushed").length > 0 ){
		//PARANDO
		renderStop();
	}
}

function secondsToMinutes(seconds){
	var minVar = Math.floor(seconds/60);  // The minutes
	var secVar = seconds % 60;  

	return minVar+":"+secVar;
}